(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{0:function(e,t){if(!window.React)throw Error("React must be defined on global variable");e.exports=window.React},205:function(e,t,n){e.exports=n(315)},311:function(e,t,n){},313:function(e,t,n){},315:function(e,t,n){"use strict";n.r(t);var a,i=n(10),r=n.n(i),o=n(12),s=n(16),l=n(0),c=n.n(l),u=n(79),d=n.n(u),p=n(202),m=n(8),v=n(2),f=n(5),h=n(1),w=n(3),b=n(4),g=n(65),x=n(203),y=n(197),_=n.n(y);g.a.plugin(x.a),g.a.plugin(_.a),g.a.plugin(n(220).default),window.PouchDB=g.a,window.session_db=new g.a("session"),window.rapyd_config||(window.rapyd_config={}),window.localStorage.rapyd_server_url||(window.rapyd_config.url?window.localStorage.rapyd_server_url=window.rapyd_config.url:"file:"===window.location.protocol?window.localStorage.rapyd_server_url="http://localhost:8069":window.localStorage.rapyd_server_url=(a=window.location.origin+window.location.pathname).substring(0,a.lastIndexOf("/"))+"/");var k={};function O(){var e=document.getElementById("app");if(e){var t={done:function(e){return k.preload_count-=1,0!=k.preload_count?e:(delete k.preload_count,k.preload_loader.remove(),k.preload_backdrop.remove(),e)}};if(k.preload_count)return k.preload_count+=1,t;k.preload_count=1;var n=document.createElement("div");n.className="preloader-modal",n.insertAdjacentHTML("beforeend",'\n    <div class="preloader color-white">\n      <span class="preloader-inner">\n        <span class="preloader-inner-gap"></span>\n        <span class="preloader-inner-left">\n          <span class="preloader-inner-half-circle"></span>\n        </span>\n        <span class="preloader-inner-right">\n          <span class="preloader-inner-half-circle"></span>\n        </span>\n      </span>\n    </div>');var a=document.createElement("div");return a.className="preloader-backdrop",e.insertAdjacentElement("beforeend",a),e.insertAdjacentElement("beforeend",n),k.preload_loader=n,k.preload_backdrop=a,t}}function E(){return(E=Object(o.a)(r.a.mark(function e(){var t,n,a;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=window.session_db,!window.models){e.next=3;break}return e.abrupt("return",{models:window.models,tools:window.tools,local_db:window.local_db});case 3:return e.prev=3,e.next=6,t.get("session");case 6:return n=e.sent,e.prev=7,e.next=10,S({login:n.login,password:n.password,encrypted:!0,client_js_time:n.client_js_time});case 10:if(a=e.sent){e.next=17;break}return e.next=14,T();case 14:window.location.reload(),e.next=18;break;case 17:a.client_js||(a.client_js=n.client_js);case 18:n=a,e.next=24;break;case 21:e.prev=21,e.t0=e.catch(7),console.log(e.t0);case 24:return e.next=26,L(n);case 26:return e.abrupt("return",{models:window.models,tools:window.tools,local_db:window.local_db});case 29:return e.prev=29,e.t1=e.catch(3),console.log(e.t1),e.abrupt("return",{});case 33:case"end":return e.stop()}},e,null,[[3,29],[7,21]])}))).apply(this,arguments)}function j(){return(j=Object(o.a)(r.a.mark(function e(t){var n;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,window.session_db.get("session");case 2:return n=e.sent,e.next=5,window.session_db.put(Object(s.a)({},n,t));case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}},e)}))).apply(this,arguments)}function S(e){return C.apply(this,arguments)}function C(){return(C=Object(o.a)(r.a.mark(function e(t){var n,a;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.encrypted=!!t.encrypted,e.next=3,D("post","json",window.localStorage.rapyd_server_url+"/api/login",t);case 3:if(n=e.sent,console.log(n),"denied"!==n.status){e.next=9;break}return e.abrupt("return",!1);case 9:if("error"!==n.status){e.next=11;break}throw Error("There are an error on the server");case 11:return e.prev=11,e.next=14,window.session_db.get("session");case 14:a=e.sent,n._rev=a._rev,n.unsaved=a.unsaved,n.client_js=n.client_js||a.client_js,n.client_js_time=n.client_js_time||a.client_js_time,e.next=24;break;case 21:e.prev=21,e.t0=e.catch(11),n.unsaved={};case 24:return n._id="session",e.next=27,window.session_db.put(n);case 27:return e.abrupt("return",n);case 28:case"end":return e.stop()}},e,null,[[11,21]])}))).apply(this,arguments)}function T(){return N.apply(this,arguments)}function N(){return(N=Object(o.a)(r.a.mark(function e(){var t;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,window.session_db.get("session");case 3:return t=e.sent,e.next=6,window.session_db.remove(t);case 6:e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.log(e.t0);case 11:return window.local_db.destroy(),e.abrupt("return",window.location.reload());case 13:case"end":return e.stop()}},e,null,[[0,8]])}))).apply(this,arguments)}function I(e){return new Promise(function(t,n){var a=setInterval(function(){e()&&(clearInterval(a),t())},0)})}function L(e){return V.apply(this,arguments)}function V(){return(V=Object(o.a)(r.a.mark(function e(t){var n,a,i,o,s,l;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=document.createElement("script"),a=window.URL||window.webkitURL;try{i=new Blob([t.client_js])}catch(r){o=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder,(i=o()).append(t.client_js),i=i.getBlob()}return n.type="text/javascript",n.src=a.createObjectURL(i),document.body.appendChild(n),e.next=8,I(function(){return window.models});case 8:return(s=window.tools).configuration=Object.assign(s.configuration,window.rapyd_config),s.configuration.url=window.localStorage.rapyd_server_url,(l=window.models).env.context.unsaved=t.unsaved||{},l.env.user=l.env["res.users"].browse(),l.env.user.id=t.id,l.env.user.login=t.login,l.env.user.password=t.password,e.next=19,s.create_data();case 19:console.log(t),s.configuration.ajax_load=function(e){e.no_preload||(e.preload=O())},s.configuration.ajax_resolve=function(e,t,n){n.no_preload||n.preload.done(),e(t.response)},s.configuration.ajax_reject=function(e,t,n){n.no_preload||n.preload.done(),e(t)},k.exceptionCount=0,s.configuration.exception=function(e){throw k.app.dialog.alert("There are some error"),k.exceptionCount+=1,e},k.warningCount=0,s.configuration.warning=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(0!==k.warningCount)return new Promise(function(t){k.warningCount=0,t(!0),console.warn(e)});console.log(k),t&&k.app.toast.create({text:"You are offline, using local data",closeButton:!0,closeTimeout:1e3}).open(),k.warningCount+=1,console.warn(e)};case 27:case"end":return e.stop()}},e)}))).apply(this,arguments)}function D(e,t,n,a){return void 0!==a&&(a=F(a)),new Promise(function(i,r){var o=new XMLHttpRequest;o.open(e,n,!0),o.onload=function(){i(this.response)},o.onerror=function(){r(this.statusText)},void 0===t&&(t="json"),o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),o.responseType=t;try{o.send(a)}catch(s){r(s)}})}function F(e){var t=[];for(var n in e){var a=e[n];"object"===typeof a?a=JSON.stringify(a):""===a&&(a=null),t.push(encodeURIComponent(n)+"="+encodeURIComponent(a))}return t.join("&")}var B={globals:k,preload:O,get_session:function(){return E.apply(this,arguments)},update_session:function(e){return j.apply(this,arguments)},wait:function(e){return new Promise(function(t,n){setTimeout(function(){return t()},e)})},wait_exist:I,login:S,logout:T,ORM:L,ajax:D,readAsDataURL:function(e){var t=O();return new Promise(function(t,n){e||n(new Error("No file available"));var a=new FileReader;a.onload=function(e){return t(e.target.result)},a.readAsDataURL(e)}).then(t.done).catch(function(e){throw t.done(),e})},parseURI:F,hasValue:function(e,t){return void 0!==e&&null!==e&&!1!==e&&([Array,String].indexOf(e.constructor)<0&&(e=e.toString()),e.indexOf(t)>-1)},hasKey:function(e,t){return void 0!==e&&null!==e&&!1!==e&&Object.keys(e).indexOf(t)>-1}},M=function(e){function t(e){var n;return Object(v.a)(this,t),(n=Object(h.a)(this,Object(w.a)(t).call(this,e))).state={username:"",password:""},n}return Object(b.a)(t,e),Object(f.a)(t,[{key:"componentDidMount",value:function(){var e=!0,t=!1,n=void 0;try{for(var a,i=document.querySelectorAll("input[type=text], input[type=password]")[Symbol.iterator]();!(e=(a=i.next()).done);e=!0){a.value.addEventListener("keyup",this.clickEvent.bind(this))}}catch(r){t=!0,n=r}finally{try{e||null==i.return||i.return()}finally{if(t)throw n}}}},{key:"render",value:function(){var e=this;return c.a.createElement(m.Page,{noToolbar:!0,noNavbar:!0,noSwipeback:!0,loginScreen:!0},c.a.createElement(m.LoginScreenTitle,null,"Welcome"),c.a.createElement(m.List,{form:!0},c.a.createElement(m.ListInput,{label:"Username",type:"text",placeholder:"Your username",value:this.state.username,onInput:function(t){e.setState({username:t.target.value})},autofocus:!0}),c.a.createElement(m.ListInput,{label:"Password",type:"password",placeholder:"Your password",value:this.state.password,onInput:function(t){e.setState({password:t.target.value})}}),c.a.createElement(m.Button,{onClick:this.signIn.bind(this),style:{float:"left",marginLeft:"10px"}},"Login"),c.a.createElement(m.Button,{onClick:this.setUrl.bind(this),style:{float:"right",marginRight:"10px"}},"Settings")))}},{key:"clickEvent",value:function(e){e.preventDefault(),13===e.keyCode&&this.signIn()}},{key:"setUrl",value:function(){this.$f7.dialog.prompt("","Server URL",function(e){return localStorage.rapyd_server_url=e});var e=document.querySelector("input.dialog-input");e&&(e.value=localStorage.rapyd_server_url)}},{key:"signIn",value:function(){var e=Object(o.a)(r.a.mark(function e(){var t,n,a,i;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=B.preload(),a=(n=this).$f7,e.prev=3,e.next=6,B.login({login:n.state.username,password:n.state.password,encrypted:!1});case 6:if(i=e.sent,t.done(),i){e.next=10;break}return e.abrupt("return",a.dialog.alert("Username/Password wrong, relogin"));case 10:a.dialog.alert("Login Successful!",function(){window.location.reload()}),e.next=18;break;case 13:throw e.prev=13,e.t0=e.catch(3),t.done(),a.dialog.alert("Network Error"),e.t0;case 18:case"end":return e.stop()}},e,this,[[3,13]])}));return function(){return e.apply(this,arguments)}}()}]),t}(c.a.Component),P=n(204),A=n(13),R=n(6),q=n(18),U=function(e){return c.a.createElement(m.Page,null,c.a.createElement(m.Navbar,{backLink:"/"!==window.models.env.context.active_url&&!e.popup&&"Back"},"/"===window.models.env.context.active_url&&c.a.createElement(m.NavLeft,null,c.a.createElement(m.Link,{iconMd:"material:menu",panelOpen:"left"})),c.a.createElement(m.NavTitle,null,e.title),e.popup?c.a.createElement(m.NavRight,null,c.a.createElement(m.Link,{iconMd:"material:close",popupClose:!0})):c.a.createElement(m.NavRight,null,c.a.createElement(m.Link,{iconMd:"material:person",panelOpen:"right"}))),e.children)},H=n(198),z=(n(249),n(251),function(e){function t(){return Object(v.a)(this,t),Object(h.a)(this,Object(w.a)(t).apply(this,arguments))}return Object(b.a)(t,e),Object(f.a)(t,[{key:"render",value:function(e){return c.a.createElement("div",{style:{height:"100%"},className:"ag-theme-material"},c.a.createElement(H.AgGridReact,{rowSelection:"multiple",paginationPageSize:e.paginationPageSize,pagination:!0,enableColResize:!0,enableServerSideSorting:!0,enableServerSideFilter:!0,suppressMultiSort:!0,suppressRowClickSelection:!0,onGridReady:e.onGridReady,onRowClicked:e.onRowClicked,onSelectionChanged:e.onSelectionChanged,onPaginationChanged:e.onPaginationChanged,onSortChanged:e.onSortChanged,onFilterChanged:e.onFilterChanged,columnDefs:e.columnDefs,rowData:e.rowData,frameworkComponents:e.frameworkComponents,singleClickEdit:!0}))}}]),t}(c.a.Component)),G=n(48),W=(n(305),n(199)),J=n.n(W),K=(n(307),0),Y=function(e){function t(e){var n;return Object(v.a)(this,t),n=Object(h.a)(this,Object(w.a)(t).call(this,e)),K+=1,n.count=K,n}return Object(b.a)(t,e),Object(f.a)(t,[{key:"componentWillUnmount",value:function(){if(this.props.inline)return document.getElementById("flatpickr-inline-clone-"+this.count)&&document.getElementById("flatpickr-inline-clone-"+this.count).remove();this.flatpickr&&this.flatpickr.destroy(),this.props.customInput&&delete this.props.customInput._flatpickr,delete this.flatpickr}},{key:"componentDidMount",value:function(){var e=this,t=this.props.customComponent?this.props.customInput:this.props.inline?document.getElementById("flatpickr-inline-clone-"+this.count)||this.refs.flatpickr.cloneNode(!1):this.refs.flatpickr;if(console.log(t),t){this.props.inline&&(t.id="flatpickr-inline-clone-"+this.count,this.refs.flatpickr.insertAdjacentElement("afterend",t));var n=this.props.onChange;this.props.readOnly&&(n=function(){var t=Object(o.a)(r.a.mark(function t(n){return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.t1=n,t.next=3,e.props.defaultDate;case 3:if(t.t2=t.sent,t.t0=t.t1!==t.t2,!t.t0){t.next=18;break}return t.next=8,e.props.defaultDate;case 8:if(!t.sent){t.next=16;break}return t.t4=e.flatpickr,t.next=12,e.props.defaultDate;case 12:t.t5=t.sent,t.t3=t.t4.setDate.call(t.t4,t.t5),t.next=17;break;case 16:t.t3=e.flatpickr.clear();case 17:t.t0=t.t3;case 18:return t.abrupt("return",t.t0);case 19:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}()),this.flatpickr=t._flatpickr||J()(t,Object(s.a)({},this.props,{allowKeyboard:!1,onChange:function(){var t=Object(o.a)(r.a.mark(function t(a){return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n(a);case 2:e.flatpickr.open();case 3:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}()}))}}},{key:"componentDidUpdate",value:function(){var e=Object(o.a)(r.a.mark(function e(){var t,n,a=this;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.props.customInput&&this.componentDidMount(),this.flatpickr){e.next=3;break}return e.abrupt("return");case 3:return t=this.props.onChange,this.props.readOnly&&(t=function(){var e=Object(o.a)(r.a.mark(function e(t){return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.t1=t,e.next=3,a.props.defaultDate;case 3:if(e.t2=e.sent,e.t0=e.t1!==e.t2,!e.t0){e.next=18;break}return e.next=8,a.props.defaultDate;case 8:if(!e.sent){e.next=16;break}return e.t4=a.flatpickr,e.next=12,a.props.defaultDate;case 12:e.t5=e.sent,e.t3=e.t4.setDate.call(e.t4,e.t5),e.next=17;break;case 16:e.t3=a.flatpickr.clear();case 17:e.t0=e.t3;case 18:return e.abrupt("return",e.t0);case 19:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),this.flatpickr.set("onChange",function(){var e=Object(o.a)(r.a.mark(function e(n){return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t(n);case 2:a.flatpickr.open();case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),e.next=8,this.props.defaultDate;case 8:if(n=e.sent,this.flatpickr){e.next=11;break}return e.abrupt("return");case 11:n?this.flatpickr.setDate(n):(this.flatpickr.selectedDateObj=null,this.flatpickr.input.value="");case 12:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(e){return e.customComponent||c.a.createElement("input",{ref:"flatpickr",style:e.inline&&{display:"none"}})}}]),t}(c.a.Component),$=G.Templates.singleSelectInput;G.Templates.singleSelectInput=function(e){return $(e).replace('<i class="fa fa-sort-desc selectivity-caret"></i>','<i class="selectivity-caret material-icons">expand_more</i>')};var X=G.Templates.singleSelectedItem;G.Templates.singleSelectedItem=function(e){return X(e).replace('<i class="fa fa-remove"></i>','<i class="selectivity-remove material-icons">close</i>')};var Q=G.Templates.multipleSelectedItem;G.Templates.multipleSelectedItem=function(e){return Q(e).replace('<i class="fa fa-remove"></i>','<i class="selectivity-remove selectivity-multi-remove material-icons">close</i>')};var Z=function(e){function t(){return Object(v.a)(this,t),Object(h.a)(this,Object(w.a)(t).apply(this,arguments))}return Object(b.a)(t,e),Object(f.a)(t,[{key:"setValue",value:function(){var e=Object(o.a)(r.a.mark(function e(t,n){var a,i,o,s;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=this.props,B.globals.onchange_running=!0,e.next=4,B.wait(0);case 4:if(B.globals.onchange_running=!1,window.models.env.context.active_error&&(window.models.env.context.active_error.field_map[this.props.name]=!1),!this.input_type||"file"!==this.input_type||!t){e.next=11;break}return e.next=9,B.readAsDataURL(t);case 9:t=(t=e.sent).split("base64,")[1];case 11:if(this.props.cellEdit){e.next=15;break}window.models.env.context.active_id[this.props.name]=t,e.next=16;break;case 15:return e.abrupt("return",window.models.env.context.refresh());case 16:return e.next=18,window.models.env.context.active_id._wait_promise();case 18:if(i=a.model,o=window.models.env[i]._fields[a.name],s=o.type,!this.refs.input){e.next=26;break}return e.next=24,this.setInputValue(t);case 24:e.next=45;break;case 26:if(!B.hasValue(["many2many","one2many","many2one","one2one"],s)||a.children){e.next=31;break}return e.next=29,this.setSelectivityValue(n);case 29:e.next=45;break;case 31:if("selection"!==s){e.next=38;break}if("statusbar"!==this.props.widget){e.next=34;break}return e.abrupt("return",this.setState({value:t}));case 34:return e.next=36,this.setSelectivityValue(n);case 36:e.next=45;break;case 38:if(!B.hasValue(["date","datetime"],s)){e.next=43;break}return e.next=41,this.setState({value:t,input:this.refs.date_input.base.querySelector("input")});case 41:e.next=45;break;case 43:return e.next=45,this.setState({value:n||t});case 45:return e.abrupt("return",window.models.env.context.refresh());case 46:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"setSelectivityValue",value:function(){var e=Object(o.a)(r.a.mark(function e(t){var n,a,i,o,s,l,c,u=this;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t;case 2:if(t=e.sent,window.tools.exist(t)){e.next=5;break}return e.abrupt("return");case 5:if(!t||"object"!==typeof t){e.next=7;break}return e.abrupt("return",this.setState({value:t}));case 7:return e.next=9,B.wait_exist(function(){return u.refs.selectivity});case 9:if(!t||t!==this.lastSelectivity){e.next=11;break}return e.abrupt("return");case 11:if(this.lastSelectivity=t,n=this.props,a=window.models,i=n.model,o=window.models.env[i]._fields[n.name],s=o.type,i){e.next=21;break}return e.abrupt("return");case 21:if(!B.hasValue(["many2many","one2many","many2one","one2one"],s)||n.children){e.next=35;break}return e.next=24,a.env[o.relation].browse(t);case 24:if((l=e.sent).length){e.next=27;break}return e.abrupt("return");case 27:if(t.constructor!==String){e.next=31;break}return e.abrupt("return",this.setState({value:{id:l.id,text:l[l._rec_name||"name"]}}));case 31:if(t.constructor!==Array){e.next=33;break}return e.abrupt("return",this.setState({value:Array.from(l.__iter__()).map(function(e){return{id:e.id,text:e[e._rec_name||"name"]}})}));case 33:e.next=38;break;case 35:if("selection"!==s){e.next=38;break}return c="function"===typeof o.selection?o.selection.apply(null):o.selection,e.abrupt("return",this.setState({value:t&&{id:t,text:window.tools.dict(c)[t]}}));case 38:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"setInputValue",value:function(e){var t=this.props,n=t.model||window.models.env.context.active_model,a=window.models.env[n]._fields[t.name].type;"binary"!==a&&("float"!==a&&"integer"!==a||(e=e||null),this.refs.input&&(B.hasValue(["text","data","boolean"],a)?"boolean"===a?this.refs.input.base.querySelector("input").checked=e:this.refs.input.base.querySelector("textarea").value="data"!==a?e:JSON.stringify(e):this.refs.input.base.querySelector("input").value=e))}},{key:"componentDidMount",value:function(){var e=Object(o.a)(r.a.mark(function e(){var t,n,a,i,o,s;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B.wait_exist(function(){return window.models.env.context.active_id});case 2:if(t=this.props,window.models,n=t.model||window.models.env.context.active_model,a=window.models.env[n]._fields[t.name],i=a.type,!((o=window.models.env.context).active_id._pending_promises.length>0)){e.next=11;break}return e.next=11,o.active_id._wait_promise();case 11:if(!t.cellEdit){e.next=15;break}e.t0=null,e.next=21;break;case 15:if(e.t1=o.active_id,!e.t1){e.next=20;break}return e.next=19,o.active_id[this.props.name];case 19:e.t1=e.sent;case 20:e.t0=e.t1;case 21:if(s=e.t0,this.props.ref_object&&Object.assign(this.props.ref_object,this.refs,{loaded:!0}),!this.refs.input){e.next=27;break}return e.abrupt("return",this.setInputValue(s));case 27:if(!B.hasValue(["many2many","one2many","many2one","one2one"],i)||t.children){e.next=31;break}return e.abrupt("return",this.setSelectivityValue(s));case 31:if("selection"!==i){e.next=37;break}if("statusbar"!==this.props.widget){e.next=34;break}return e.abrupt("return",this.setState({value:s}));case 34:return e.abrupt("return",this.setSelectivityValue(s));case 37:if(!B.hasValue(["date","datetime"],i)){e.next=41;break}return e.abrupt("return",this.setState({value:s,input:this.refs.date_input.base.querySelector("input")}));case 41:return e.abrupt("return",this.setState({value:s}));case 42:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"componentWillUnmount",value:function(){this.refs.selectivity&&this.refs.selectivity.selectivity&&this.refs.selectivity.selectivity.destroy()}},{key:"render",value:function(e){var t=this,n=window.models,a=e.model||window.models.env.context.active_model,i=window.models.env[a]._fields[e.name];if(i){var l=e.string||i.string,u=i.type,d={char:"text",text:"textarea",float:"number",integer:"number",data:"textarea",boolean:"checkbox",binary:"file"},p=window.models.env.context,v=(this.refs,e.cellEdit?p.active_lines[this.props.tree.state.model][(this.props.tree.props.parent_model?"many2many_":"")+this.props.tree.state.tree_field].find(this.props.tree.state.records[this.props.rowIndex].id||this.props.tree.state.records[this.props.rowIndex]._original_object_for_id):p.active_id),f=e.invisible instanceof Function&&v?e.invisible(v,n.env.context.active_id):e.invisible;e.readonly=i.readonly||e.readonly;var h,w=e.readonly instanceof Function?e.readonly(v):e.readonly,b=e.cellEdit?null:p.active_id&&p.active_id[this.props.name];if(B.hasValue(["many2many","one2many"],u)&&e.children)return e.children;if("selection"===u&&"statusbar"===e.widget){var g=!0,x="function"===typeof i.selection?i.selection.apply(p.active_id,[p.active_id]):i.selection;return x=window.tools.copy(x).reverse(),e.visible&&(x=x.filter(function(t){return e.visible.split(",").indexOf(t[0])>-1||n.env.context.active_id&&n.env.context.active_id[e.name]===t[0]})),h=c.a.createElement("div",{style:Object(s.a)({},f?{display:"none"}:{},{overflow:"overlay"})},x.map(function(t){return g?c.a.createElement(m.F7Button,{raised:n.env.context.active_id&&n.env.context.active_id[e.name]===t[0],className:"rapyd-statusbars"},(g=!1)||t[1]):[c.a.createElement("span",{className:"rapyd-statusbars rapyd-statusbar-arrow"},">"),c.a.createElement(m.F7Button,{raised:n.env.context.active_id&&n.env.context.active_id[e.name]===t[0],className:"rapyd-statusbars"},t[1])]}))}if(B.hasValue(["many2many","one2many","many2one","one2one","selection"],u)){var y,_=null;if(B.hasValue(["many2many","one2many","many2one","one2one"],u))y={url:window.tools.configuration.url,minimumInputLength:0,params:function(){return{}},placeholder:"",fetch:function(e,t,n){return S.apply(this,arguments)}};else if("selection"===u){_=("function"===typeof i.selection?i.selection.apply(p.active_id,[p.active_id]):i.selection).map(function(e){return{id:e[0],text:e[1]}})}var k=window.models.env.context.active_id,O=function(){var t=window.models.env.context.active_id,n=function(){window.models.env.context.active_id.values=k.values,window.models.env.context.active_id[e.name]=t.id,window.models.env.context.editing||window.models.env.context.active_id.write()};B.wait(100).then(function(){return B.globals.app.views.main.router.back()&&B.wait_exist(function(){return window.models.env.context.active_id._name===a}).then(n)})},E=!w&&p.editing&&window.models.env.context.active_id&&!window.models.env.context.active_id[e.name];if(h=[c.a.createElement(m.ListInput,{label:l,input:!1,disabled:w||!p.editing,errorMessageForce:!!window.models.env.context.active_error&&window.models.env.context.active_error.field_map[e.name],errorMessage:"Field required",style:!e.cellEdit&&"selection"!==u&&E&&{height:"65px"}},c.a.createElement(G.React,{ref:"selectivity",slot:"input",data:window.tools.exist(this.state.value)&&this.state.value.constructor!==Promise?this.state.value:null,ajax:y,items:_,placeholder:e.placeholder||"",readOnly:w||!p.editing,multiple:B.hasValue(["many2many","one2many"],u),onChange:function(e){return t.setValue(e.value,e.data)},onDropdownOpen:function(){return t.setState({selectivityOpened:!0})},onDropdownClose:function(){return(!e.onSelect||e.onSelect())&&t.setState({selectivityOpened:!1})},allowClear:!0,closeOnSelect:!0})),!e.cellEdit&&"selection"!==u&&c.a.createElement("i",{className:"icon material-icons",onClick:Object(o.a)(r.a.mark(function e(){return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t1=B.globals.app.views.main.router.navigate("/form/"+i.relation),!e.t1){e.next=5;break}return e.next=4,B.wait(100);case 4:e.t1=!e.sent;case 5:if(e.t0=e.t1,!e.t0){e.next=8;break}e.t0=window.models.env.context.active_task.push(O);case 8:return e.abrupt("return",e.t0);case 9:case"end":return e.stop()}},e)})),style:{top:"-30px",left:"280px",display:E?"unset":"none"}},"open_in_new")],e.cellEdit)return h[0].children[0];B.wait(500).then(function(){return B.wait_exist(function(){return p.active_id})}).then(Object(o.a)(r.a.mark(function n(){return r.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,p.active_id[e.name];case 2:if(n.t0=n.sent,!n.t0){n.next=9;break}return n.t1=t,n.next=7,p.active_id[e.name];case 7:n.t2=n.sent,n.t0=n.t1.setSelectivityValue.call(n.t1,n.t2);case 9:return n.abrupt("return",n.t0);case 10:case"end":return n.stop()}},n)})))}else if(B.hasValue(["date","datetime"],u)){var j=c.a.createElement("ul",null,c.a.createElement(m.ListInput,{ref:"date_input",label:l,placeholder:e.placeholder||"",disabled:w||!p.editing,errorMessageForce:!!window.models.env.context.active_error&&window.models.env.context.active_error.field_map[e.name],errorMessage:"Field required"}));if(h=c.a.createElement(Y,{customComponent:j,customInput:this.state.input,enableTime:"datetime"===u&&!0,enableSeconds:"datetime"===u&&!0,defaultDate:this.state.value||b,onChange:function(e){return console.log(e)||t.setValue(e)}}),e.cellEdit)return h.children.children}else this.input_type=d[u],h=c.a.createElement(m.ListInput,{ref:"input",label:l,type:d[u],placeholder:e.placeholder||"",disabled:w||!p.editing,onChange:function(e){return t.setValue("checkbox"===e.target.type?e.target.checked:"file"===e.target.type?e.target.files[0]:e.target.value)},errorMessageForce:!!window.models.env.context.active_error&&window.models.env.context.active_error.field_map[e.name],errorMessage:"Field required"}),B.wait_exist(function(){return t.refs.input}).then(Object(o.a)(r.a.mark(function e(){return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=t,e.next=3,b;case 3:if(e.t2=e.sent,e.t2){e.next=8;break}return e.next=7,t.state.value;case 7:e.t2=e.sent;case 8:if(e.t1=e.t2,e.t1){e.next=11;break}e.t1=null;case 11:return e.t3=e.t1,e.abrupt("return",e.t0.setInputValue.call(e.t0,e.t3));case 13:case"end":return e.stop()}},e)})));return c.a.createElement(m.List,{style:Object(s.a)({},f?{display:"none"}:{},this.state.selectivityOpened?{}:{zIndex:"0"})},h)}function S(){return(S=Object(o.a)(r.a.mark(function t(a,o,s){var l,c,d,p,m,f,h,w,b,g,x,y,_;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,c=10,n.env.context.active_limit=c,n.env.context.active_index=s.offset/c,d=v&&e.domain?e.domain.apply(e,Object(q.a)(e.cellEdit?[v,n.env.context.active_id]:[v])):[],t.next=7,(l=n.env[i.relation].with_context({no_preload:!0})).search.apply(l,[[n.env[i.relation]._rec_name||"name","ilike",s.term]].concat(Object(q.a)(d)));case 7:if(p=t.sent,n.env.context.active_lines[i.relation])for(m in n.env.context.active_lines[i.relation])p.add(n.env.context.active_lines[i.relation][m].filter(function(e){return e[e._rec_name||"name"]&&-1!==e[e._rec_name||"name"].toLowerCase().indexOf(s.term.toLowerCase())}));if(f=[],"selection"!==u){t.next=12;break}return t.abrupt("return",{results:f,more:!1});case 12:h=!0,w=!1,b=void 0,t.prev=15,g=p[Symbol.iterator]();case 17:if(h=(x=g.next()).done){t.next=29;break}if((y=x.value).id){t.next=25;break}return _="etemp"+Math.random().toString(36).substr(2,9),B.globals.temp_records||(B.globals.temp_records={}),B.globals.temp_records[_]=y,f.push({id:_,text:y[y._rec_name||"name"]}),t.abrupt("continue",26);case 25:f.push({id:y.id,text:y[y._rec_name||"name"]});case 26:h=!0,t.next=17;break;case 29:t.next=35;break;case 31:t.prev=31,t.t0=t.catch(15),w=!0,b=t.t0;case 35:t.prev=35,t.prev=36,h||null==g.return||g.return();case 38:if(t.prev=38,!w){t.next=41;break}throw b;case 41:return t.finish(38);case 42:return t.finish(35);case 43:return n.env.context.active_index=0,console.log((s.offset/c+1)*c<p._search_count),console.log(f),t.abrupt("return",{results:f,more:(s.offset/c+1)*c<p._search_count});case 49:throw t.prev=49,t.t1=t.catch(0),console.error(t.t1),t.t1;case 53:case"end":return t.stop()}},t,null,[[0,49],[15,31,35,43],[36,,38,42]])}))).apply(this,arguments)}}}]),t}(c.a.Component),ee=function(e){function t(){return Object(v.a)(this,t),Object(h.a)(this,Object(w.a)(t).apply(this,arguments))}return Object(b.a)(t,e),Object(f.a)(t,[{key:"afterGuiAttached",value:function(){var e=Object(o.a)(r.a.mark(function e(){var t=this;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B.wait_exist(function(){return t.refs.loaded});case 2:this.refs.selectivity&&this.refs.selectivity.selectivity&&this.refs.selectivity.selectivity.open();case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getValue",value:function(){if(this.refs.selectivity&&this.refs.selectivity.selectivity){var e=this.refs.selectivity.selectivity.getData();if(!e)return this.props.tree.state.records[this.props.rowIndex][this.props.name];var t=window.tools.copy(this.props.column.colDef);delete t.cellEditorFramework;var n=this.refs.selectivity.selectivity.getValue();Array.isArray(n)||(n=[n]);var a=window.models.env[this.props.model]._fields[this.props.name],i=a.relation&&window.models.env[a.relation],r=!0,o=!1,s=void 0;try{for(var l,c=n[Symbol.iterator]();!(r=(l=c.next()).done);r=!0){var u=l.value;if(!a.relation)break;if("etemp"===u.slice(0,5))i.add(B.globals.temp_records[u]);else{var d=i.browse();d.update({id:u}),i.add(d)}}}catch(p){o=!0,s=p}finally{try{r||null==c.return||c.return()}finally{if(o)throw s}}return e=Array.isArray(e)?e.map(function(e){return e.text}).join(", "):e.text,this.props.tree.onChange({colDef:t,data:this.props.tree.state.records[this.props.rowIndex],specialValue:e,oldValue:null,newValue:a.relation?i:this.refs.selectivity.selectivity.getValue()}),e}}},{key:"onSelect",value:function(){var e=Object(o.a)(r.a.mark(function e(){return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B.wait(10);case 2:this.props.api.stopEditing();case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(e){this.refs={};var t=this.onSelect.bind(this);return c.a.createElement(Z,Object.assign({},e,{ref_object:this.refs,cellEdit:!0,onSelect:t}))}}]),t}(l.Component),te=n(200),ne=n.n(te),ae=n(201),ie=n.n(ae);function re(e,t){if(this){this.gridOptions=e;var n=!0,a=!1,i=void 0;try{for(var r,o=e.api.gridCore.gridOptions.columnDefs[Symbol.iterator]();!(n=(r=o.next()).done);n=!0){var s=r.value;e.api.getFilterInstance(s.field).eClearButton.addEventListener("click",function(){return e.api.onFilterChanged()})}}catch(v){a=!0,i=v}finally{try{n||null==o.return||o.return()}finally{if(a)throw i}}}var l=e.api.gridPanel.getWidthForSizeColsToFit(),c=e.api.gridPanel.columnController.getAllDisplayedColumns(),u=e.api.gridPanel.columnController.getWidthOfColsInList(c),d=Math.max.apply(Math,Object(q.a)(Array.prototype.slice.call(document.querySelectorAll("div.ag-header-row")).filter(function(e){return e.offsetParent}).map(function(e){return parseFloat(e.style.width.replace("px",""))}))),p=document.getElementById("rapyd-maximum-tree-width")||document.createElement("style");if(p.id="rapyd-maximum-tree-width",p.innerHTML=".rapyd-card-sheet {min-width: "+(d+20)+"px}",document.querySelector("head").append(p),u<=l+6)return e.api.sizeColumnsToFit();var m=[];e.columnApi.getAllColumns().forEach(function(e){m.push(e.colId)}),e.columnApi.autoSizeColumns(m)}var oe=function(e){function t(e){var n;Object(v.a)(this,t),n=Object(h.a)(this,Object(w.a)(t).call(this,e));var a=e.model||window.models.env.context.active_model,i=Object(R.a)(Object(R.a)(n));function l(t){var n;if(e.isTreeView&&!e.editable&&(n=!1),window.models.env.context.editing&&(n=!0),n&&this&&this!=i){var a=window.models.env.context,r=e.model||window.models.env.context.active_model,o=window.models.env[r]._fields[this.props.name],s=a.active_lines[i.state.model][(i.props.parent_model?"many2many_":"")+i.state.tree_field].find(i.state.records[t.node.rowIndex].id||i.state.records[t.node.rowIndex]._original_object_for_id),l=o.readonly||this.props.readonly;return!(l instanceof Function?l(s):l)}return n||!1}n.isEditable=l,n.pendingTask={create:!1,write:!1,tasked:!1},n.pendingCreate=!1,n.pendingWrite=!1,n.taskJob=function(){var e=this;this.pendingTask.tasked||(this.pendingTask.tasked=!0,window.models.env.context.active_task.push(Object(o.a)(r.a.mark(function t(){return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.pendingTask.create){t.next=3;break}return t.next=3,e.state.new_records.create();case 3:if(!e.pendingTask.write){t.next=6;break}return t.next=6,window.models.env.context.active_lines[e.state.model][(e.props.parent_model?"many2many_":"")+e.state.tree_field].write();case 6:e.props.parent_model&&window.models.env.context.active_id.write(Object(A.a)({},e.state.tree_field,window.models.env.context.active_lines[e.state.model]["many2many_"+e.state.tree_field].ids));case 7:case"end":return t.stop()}},t)})).bind(this)))}.bind(Object(R.a)(Object(R.a)(n))),n.onChange=function(e){var t=this;if(!e.colDef.cellEditorFramework&&e.newValue!=e.oldValue){var n=e.newValue,a=window.models.env.context.active_lines[this.state.model][(this.props.parent_model?"many2many_":"")+this.state.tree_field],i=e.data.id?a.find(e.data.id):a.find(e.data._original_object_for_id);if(!this.pendingTask.write&&i.id?this.pendingTask.write=!0:this.pendingTask.create||i.id||(this.pendingTask.create=!0),this.pendingTask.tasked||!this.pendingTask.create&&!this.pendingTask.write||this.taskJob(),i[e.colDef.field]=n,!e.selectedOnchange&&this.state.selected){var r=!0,o=!1,s=void 0;try{for(var l,c=this.state.selected[Symbol.iterator]();!(r=(l=c.next()).done);r=!0){var u=l.value;u!==e.data&&(this.onChange({colDef:e.colDef,selectedOnchange:!0,data:u,specialValue:e.specialValue,oldValue:null,newValue:n}),u[e.colDef.field]=e.specialValue||n)}}catch(d){o=!0,s=d}finally{try{r||null==c.return||c.return()}finally{if(o)throw s}}B.wait(100).then(function(){return t.gridOptions.api.deselectAll()}).then(function(){return t.setState({records:t.state.records})}).then(function(){return!e.colDef.cellEditorParams&&t.gridOptions.api.refreshCells()})}}}.bind(Object(R.a)(Object(R.a)(n))),n.onSelectionChanged=function(e){var t=this,n=e.api.getSelectedRows();n.length>this.state.limit&&(n=n.slice(this.state.limit*e.api.paginationGetCurrentPage(),this.state.limit*(e.api.paginationGetCurrentPage()+1)));var a=[],i=!0,r=!1,o=void 0;try{for(var s,l=n[Symbol.iterator]();!(i=(s=l.next()).done);i=!0){var c=s.value;c.id&&a.push(c.id)}}catch(u){r=!0,o=u}finally{try{i||null==l.return||l.return()}finally{if(r)throw o}}return this.pagingCalled=!0,B.wait(1e3).then(function(){return t.pagingCalled=!1}),this.setState({active_ids:a,selected:n})}.bind(Object(R.a)(Object(R.a)(n))),n.handleOutside=function(e){this.refs.grid&&!this.refs.grid.base.querySelector("div.ag-body").contains(e.target)&&this.gridOptions&&this.gridOptions.api.stopEditing()}.bind(Object(R.a)(Object(R.a)(n)));var c=(e.children.constructor===Array?e.children:[e.children]).map(function(e,t){return Object(s.a)({headerName:e.attributes.string||window.models.env[a]._fields[e.attributes.name].string,field:e.attributes.name,suppressMovable:!0,filterParams:{applyButton:!0,clearButton:!0,newRowsAction:"keep"},editable:l.bind(e),invisible:e.props.invisible,onCellValueChanged:n.onChange},e.props.sort?(n.default_sort=e.props.name+" "+e.props.sort)&&{sort:e.props.sort}:{},-1!==["date","datetime","selection"].indexOf(window.models.env[a]._fields[e.attributes.name].type)||window.models.env[a]._fields[e.attributes.name].relation?{cellEditorFramework:ee,cellEditorParams:Object(s.a)({},e.props,{model:a,tree:Object(R.a)(Object(R.a)(n))}),cellClass:"editable-special-cell"}:{})});c[0].checkboxSelection=!0,c[0].headerCheckboxSelection=!0;var u=parseInt(e.limit)||(e.isTreeView?50:500);return n.state={fields:c,records:[],new_records:window.models.env[a],limit:u,model:a,frameworkComponents:{specialEditor:ee},selected:[]},e.field&&(n.state.tree_field=e.field),n}return Object(b.a)(t,e),Object(f.a)(t,[{key:"componentDidUpdate",value:function(){this.gridOptions&&re(this.gridOptions)}},{key:"componentDidMount",value:function(){var e=this;this.props.isTreeView&&this.refs.grid&&this.refs.grid.base&&this.refs.grid.base.querySelector("span.ag-paging-row-summary-panel")&&(this.refs.grid.base.querySelector("span.ag-paging-row-summary-panel").onclick=function(){B.globals.app.dialog.prompt("","Limit",function(t){return(e.state.limit=parseInt(t))&&e.paging(0,{newData:!1,forceUpdate:!0})});var t=document.querySelector("input.dialog-input");t&&(t.type="number",t.value=e.state.limit)}),document.addEventListener("mousedown",this.handleOutside)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("mousedown",this.handleOutside),window.removeEventListener("resize",this.resizeListener),document.getElementById("rapyd-maximum-tree-width")&&document.getElementById("rapyd-maximum-tree-width").remove()}},{key:"paginate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(e.length<1)return e;var n=e[0]._search_count,a=Object(s.a)({},e[0]);for(var i in a)a[i]=null;if(t>0)for(var r=0;r<this.state.limit*t;)e.unshift(a),r+=1;for(;e.length<n;)e.push(a);return e}},{key:"sort",value:function(e,t){var n=window.models;e.length>0?n.env.context.active_sort=e[0].colId+" "+e[0].sort:delete n.env.context.active_sort,0!==t.api.paginationGetCurrentPage()?t.api.paginationGoToFirstPage():(t.newData=!1,t.forcePopup=!0,t.forceUpdate=!0,this.paging.bind(this)(0,t))}},{key:"filter",value:function(){var e=Object(o.a)(r.a.mark(function e(t,n){var a,i,o,s,l,c,u,d,p,m,v,f;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=window.models,!this.state.tree_field){e.next=4;break}return e.next=4,B.wait_exist(function(){return a.env.context.active_id});case 4:i=[],o=[],e.t0=r.a.keys(t);case 7:if((e.t1=e.t0()).done){e.next=31;break}s=e.t1.value,l=[t[s]],c="AND",void 0!==t[s].operator&&(l=[t[s].condition1,t[s].condition2],c=t[s].operator),u={startsWith:"ilike",endsWith:"ilike",contains:"ilike",notContains:"not ilike",equals:"=",notEqual:"!="},"OR"===c&&i.push("|"),d=0,p=l;case 15:if(!(d<p.length)){e.next=29;break}if(m=p[d],o.push(m.filter),!a.env[this.state.model]._fields[s].relation){e.next=25;break}return v=a.env[a.env[this.state.model]._fields[s].relation],e.next=22,v.search([v._rec_name||"name",u[m.type],m.filter]);case 22:return f=e.sent,i.push([s,"in",f.ids]),e.abrupt("continue",26);case 25:i.push([s,u[m.type],m.filter]);case 26:d++,e.next=15;break;case 29:e.next=7;break;case 31:if(this.args=i,0===n.api.paginationGetCurrentPage()){e.next=37;break}return e.next=35,n.api.paginationGoToFirstPage();case 35:e.next=42;break;case 37:return n.newData=!1,n.forcePopup=!0,n.forceUpdate=!0,e.next=42,this.paging.bind(this)(0,n);case 42:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"paging",value:function(){var e=Object(o.a)(r.a.mark(function e(t,n){var a,i,o,s,l,c=this;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.pagingStarted&&!document.getElementsByClassName("preloader-modal").length&&(this.pagingStarted=!1),!1===n.newData&&(n.forceUpdate||this.props.isTreeView)&&!this.pagingStarted){e.next=3;break}return e.abrupt("return");case 3:if(0!==t||!this.props.isPopup||n.forcePopup){e.next=5;break}return e.abrupt("return");case 5:if(e.prev=5,i=window.models,!this.state.tree_field){e.next=10;break}return e.next=10,B.wait_exist(function(){return i.env.context.active_id});case 10:if(!this.state.tree_field||i.env.context.active_id&&this.props.view_model===i.env.context.active_id._name){e.next=12;break}return e.abrupt("return");case 12:return n.deleting&&(this.args||(this.args=[]),this.args.push(["id","not in",this.state.active_ids])),!this.page_domain&&B.globals.app.view.main.router.currentRoute.query.domain&&(this.page_domain=JSON.parse(B.globals.app.view.main.router.currentRoute.query.domain)),o=(this.props.field_name?[["id","in",window.models.env.context.active_id[this.props.field_name]||[]]]:[]).concat(this.page_domain||[]),this.args&&o.push.apply(o,Object(q.a)(this.args)),i.env.context.active_args=o,i.env.context.active_limit=this.state.limit,i.env.context.active_index=t,!i.env.context.active_sort&&this.default_sort&&(i.env.context.active_sort=this.default_sort)&&delete this.default_sort,this.pagingStarted=!0,e.next=23,(a=i.env[this.state.model]).search.apply(a,Object(q.a)(o).concat(Object(q.a)((this.props.domain instanceof Function?this.props.domain({}):this.props.domain)||[])));case 23:if(s=e.sent,this.props.isTreeView?s.add(this.state.new_records):(i.env.context.active_lines||(i.env.context.active_lines={}),i.env.context.active_lines[this.state.model]||(i.env.context.active_lines[this.state.model]={}),i.env.context.active_lines[this.state.model][(this.props.parent_model?"many2many_":"")+this.state.tree_field]?s=i.env.context.active_lines[this.state.model][(this.props.parent_model?"many2many_":"")+this.state.tree_field].add(s):i.env.context.active_lines[this.state.model][(this.props.parent_model?"many2many_":"")+this.state.tree_field]=s),!(s.length>0)){e.next=40;break}return!this.props.isTreeView&&this.args&&(s=s.filter(function(e){var t,n=window.tools.copy(c.args),a=!0,i=!1,r=void 0;try{for(var o,s=n[Symbol.iterator]();!(a=(o=s.next()).done);a=!0){var l=o.value;Array.isArray(l)&&(l[0]=e[l[0]])}}catch(u){i=!0,r=u}finally{try{a||null==s.return||s.return()}finally{if(i)throw r}}return(t=window.tools).apply_domain.apply(t,Object(q.a)(n))})),e.t0=this,e.t1=this,e.next=31,(l=s).sort_by.apply(l,Object(q.a)(i.env.context.active_sort?i.env.context.active_sort.split(" ").map(function(e){return"asc"!=e&&e}):[s._rec_name||"name",!1])).read(!0,this.state.fields.map(function(e){return e.field}));case 31:return e.t2=e.sent,e.t3=t,e.t4=e.t1.paginate.call(e.t1,e.t2,e.t3),e.t5=this.state.limit,e.t6={records:e.t4,limit:e.t5},e.next=38,e.t0.setState.call(e.t0,e.t6);case 38:e.next=43;break;case 40:if(0!==s.length){e.next=43;break}return e.next=43,this.setState({records:[]});case 43:e.next=48;break;case 45:e.prev=45,e.t7=e.catch(5),console.error(e.t7);case 48:case"end":return e.stop()}},e,this,[[5,45]])}));return function(t,n){return e.apply(this,arguments)}}()},{key:"addItem",value:function(){var e=Object(o.a)(r.a.mark(function e(){var t,n;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isEditable()){e.next=2;break}return e.abrupt("return");case 2:if(t=window.models.env[this.state.model].browse(),window.models.env.context.active_id.id&&!this.props.parent_model&&(t[this.state.tree_field]=window.models.env.context.active_id.id),!(t._pending_promises.length>0)){e.next=8;break}return e.next=7,t._wait_promise();case 7:this.pendingTask.tasked||(this.pendingTask.create=!0,this.taskJob());case 8:return e.next=10,t.read(!0,this.state.fields.map(function(e){return e.field}));case 10:return n=e.sent,this.state.new_records.add(t),this.state.records.push(n[0]),this.props.treeView||window.models.env.context.active_lines[this.state.model][(this.props.parent_model?"many2many_":"")+this.state.tree_field].add(t),e.next=16,this.setState({records:this.state.records,new_records:this.state.new_records});case 16:this.gridOptions.api.updateRowData({add:n});case 17:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"chooseItem",value:function(){var e=Object(o.a)(r.a.mark(function e(){var t;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.refs.popup.paging(0,{newData:!1,forcePopup:!0});case 2:return(t=this.refs.popup_modal.getDOMNode()).className="popup modal-in",t.children[0].className=t.children[0].className.replace("page-next","").replace("page-previous",""),re(this.refs.popup.gridOptions),e.abrupt("return");case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"selectItem",value:function(){var e=Object(o.a)(r.a.mark(function e(){var t,n;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.state.active_ids.length>0)){e.next=12;break}return e.next=3,window.models.env[this.props.model].browse(this.state.active_ids);case 3:return t=e.sent,n=window.models.env.context.active_lines[this.props.model][(this.props.many2many?"many2many_":"")+this.props.active_field].add(t),window.models.env.context.active_id[this.props.active_field_name]=n,e.next=8,window.models.env.context.active_id._wait_promise();case 8:return e.next=10,this.props.parent_tree.paging(0,{newData:!1,forceUpdate:!0});case 10:this.gridOptions.api.deselectAll(),this.props.parent_tree.refs.popup_modal.getDOMNode().className=this.props.parent_tree.refs.popup_modal.getDOMNode().className.replace("modal-in","modal-out");case 12:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"removeItem",value:function(){var e=Object(o.a)(r.a.mark(function e(){var t,n,a,i,o,s,l,c,u,d,p,m,v,f;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.props.isTreeView){e.next=9;break}return e.next=3,window.models.env[this.state.model].browse(this.state.active_ids);case 3:return t=e.sent,e.next=6,t.unlink();case 6:return e.next=8,this.paging.bind(this)(0,{newData:!1});case 8:return e.abrupt("return",this.gridOptions.api.deselectAll());case 9:n=window.models.env[this.props.parent_model||this.state.model]._fields[this.state.tree_field],a=n.type,i=!0,o=!1,s=void 0,e.prev=14,l=this.state.selected[Symbol.iterator]();case 16:if(i=(c=l.next()).done){e.next=43;break}for(u=c.value,d=this.state.records.length;d--;)u===this.state.records[d]&&this.state.records.splice(d);if(window.models.env.context.active_id.id&&"many2one"==a){e.next=33;break}if(console.log(a),p=window.models.env.context.active_lines[this.state.model][(this.props.parent_model?"many2many_":"")+this.state.tree_field],m=p.values,Array.isArray(m)){e.next=30;break}if("many2one"==a){e.next=28;break}return u._original_object_for_id&&u._original_object_for_id===m?p._values[0]={}:u.id===m.id&&(p._values[0]={})&&delete p._values[u.id],e.abrupt("continue",40);case 28:return(u._original_object_for_id?u._original_object_for_id===m:u.id===m.id)&&(window.models.env.context.active_lines[this.state.model][(this.props.parent_model?"many2many_":"")+this.state.tree_field]=window.models.env[this.state.model]),e.abrupt("continue",40);case 30:for(v=m.length;v--;)u._original_object_for_id&&u._original_object_for_id===m[v]?m.splice(v):u._original_object_for_id||u.id!==m[v].id||m.splice(v)||delete p._values[u.id];return e.abrupt("continue",40);case 33:if("many2one"==a){e.next=35;break}return e.abrupt("continue",40);case 35:(f={data:u}).oldValue="",f.newValue=null,f.colDef={field:this.state.tree_field},this.onChange(f);case 40:i=!0,e.next=16;break;case 43:e.next=49;break;case 45:e.prev=45,e.t0=e.catch(14),o=!0,s=e.t0;case 49:e.prev=49,e.prev=50,i||null==l.return||l.return();case 52:if(e.prev=52,!o){e.next=55;break}throw s;case 55:return e.finish(52);case 56:return e.finish(49);case 57:return this.state.selected,"many2one"!=a&&(window.models.env.context.active_id[this.state.tree_field]=window.models.env.context.active_lines[this.state.model][(this.props.parent_model?"many2many_":"")+this.state.tree_field]),e.next=61,this.paging.bind(this)(0,{newData:!1,deleting:!0,forceUpdate:!0});case 61:return e.abrupt("return",this.gridOptions.api.deselectAll());case 62:case"end":return e.stop()}},e,this,[[14,45,49,57],[50,,52,56]])}));return function(){return e.apply(this,arguments)}}()},{key:"exportItem",value:function(){return this.state.selected?(ie.a.saveAs(new Blob([ne.a.serialize({fields:Object.keys(this.state.selected[0]).map(function(e){return{id:e}}),records:this.state.selected})],{type:"text/csv;charset=utf-8"}),document.getElementById("main-view").querySelector("div.title").innerText+".csv"),this.gridOptions.api.deselectAll()):this.gridOptions.api.deselectAll()}},{key:"render",value:function(e){var n=this,a=e.model||window.models.env.context.active_model,i=window.models,r=void 0!==e.choose?e.choose instanceof Function?e.choose(i.env.context.active_id):e.choose:e.parent_model,o=e.invisible instanceof Function?e.invisible(window.models.env.context.active_id):e.invisible,l=c.a.createElement("div",{className:"card-body"+(o?" rapyd-tree-is-invisible":""),style:Object(s.a)({height:48*Math.min(this.state.records.length,this.state.limit)+112+(n.isEditable()?30:0)+"px"},o?{position:"absolute",left:"-9999px",top:"-9999px"}:{})},c.a.createElement(z,{ref:"grid",onGridReady:function(e){return re.bind(n)(e)||window.addEventListener("resize",n.resizeListener=function(){return re(e,n.resizeListener)})}.bind(this),onRowClicked:function(e){return i.env[n.state.model].browse(null).then(function(e){return delete i.env.context.active_id}).then(function(){return B.globals.app.views.main.router.navigate("/form/"+a+"?id="+e.data.id)})},onPaginationChanged:function(e){return n.paging.bind(n)(e.api.paginationGetCurrentPage(),e)},onSortChanged:function(e){return n.sort.bind(n)(e.api.getSortModel(),e)},onFilterChanged:function(e){return n.filter.bind(n)(e.api.getFilterModel(),e)},onSelectionChanged:this.onSelectionChanged,paginationPageSize:this.state.limit,columnDefs:this.state.fields.filter(function(t){return!e.isTreeView&&i.env.context.active_id&&t.invisible instanceof Function?!t.invisible({},i.env.context.active_id):!t.invisible}),rowData:this.state.records,frameworkComponents:this.state.frameworkComponents}),c.a.createElement(m.Button,{onClick:this.addItem.bind(this),style:{display:this.isEditable()&&!1!==(e.create instanceof Function?e.create(i.env.context.active_id):e.create)?"inline-block":"none",top:"-45px",backgroundColor:"#fff"}},"Add"),c.a.createElement(m.Button,{onClick:this.chooseItem.bind(this),style:{display:r&&this.isEditable()?"inline-block":"none",top:"-45px",backgroundColor:"#fff"}},"Choose"),c.a.createElement(m.Button,{onClick:this.selectItem.bind(this),style:{display:e.isPopup&&this.state.selected.length>0?"inline-block":"none",top:"-45px",backgroundColor:"#fff"}},"Select"),c.a.createElement(m.Button,{onClick:this.exportItem.bind(this),style:{display:e.isTreeView&&this.state.selected.length>0?"inline-block":"none",top:"-45px",backgroundColor:"#fff"}},"Export"),!e.isPopup&&window.tools.view[this.state.model]&&window.tools.view[this.state.model].actions.tree&&Object.entries(window.tools.view[this.state.model].actions.tree).map(function(t){var a=Object(P.a)(t,2),r=a[0],o=a[1];return c.a.createElement(m.Button,{onClick:function(){return i.env[n.state.model].browse(n.state.active_ids).then(function(e){return e[r]()}).then(function(){return n.gridOptions.api.deselectAll()})}.bind(n),style:{display:(e.isTreeView||!i.env.context.editing)&&n.state.selected.length>0?"inline-block":"none",top:"-45px",backgroundColor:"#fff"}},o)}),c.a.createElement(m.Button,{className:"rapyd-tree-delete-button",onClick:this.removeItem.bind(this),style:{display:(e.isTreeView||this.isEditable())&&!e.isPopup&&this.state.selected.length>0?"inline-block":"none",top:"-45px",backgroundColor:"#fff"}},"Delete"),!e.isTreeView&&(e.parent_model||r)&&c.a.createElement(m.Popup,{ref:"popup_modal",backdrop:!1,animate:!0},c.a.createElement(U,{popup:!0,title:window.tools.view[this.state.model]?window.tools.view[this.state.model].string:"Choose"},c.a.createElement("div",{className:"card"},c.a.createElement(t,{ref:"popup",isTreeView:!0,isPopup:!0,many2many:!!e.parent_model,parent_tree:this,active_field:this.state.tree_field,active_field_name:e.field_name,model:this.state.model,domain:(this.state.records.length>0?[["id","not in",window.models.env.context.active_lines[e.model][(this.props.parent_model?"many2many_":"")+this.state.tree_field].ids]]:[]).concat(e.domain?e.domain(i.env.context.active_id):[])},Array.prototype.slice.call((new DOMParser).parseFromString(window.tools.view[this.state.model]&&window.tools.view[this.state.model].tree||e.tree_arch||'<tree><field name="'+(window.models.env[this.state.model]._rec_name||"name")+'"/></tree>',"text/xml").children[0].children).map(function(e){var t={model:a},n=!0,i=!1,r=void 0;try{for(var o,s=e.attributes[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var l=o.value;t[l.name]=l.value}}catch(u){i=!0,r=u}finally{try{n||null==s.return||s.return()}finally{if(i)throw r}}return c.a.createElement(null,t)}))))));return e.isTreeView||B.wait(0).then(function(){return n.pagingCalled?B.wait(1e3).then(function(){return n.pagingCalled=!1}):(n.pagingCalled=!0)&&n.paging(0,{newData:!1,forceUpdate:!0})}),!e.isTreeView||e.isPopup?(window.models.env.context.editing&&delete l.props.children[0].props.onRowClicked,l):c.a.createElement(U,{title:e.title||window.tools.view[this.state.model].string},c.a.createElement("div",{className:"card"},c.a.createElement("div",{className:"card-header"},c.a.createElement("div",{className:"data-table-title"},e.title||window.tools.view[this.state.model].string,c.a.createElement("br",null),c.a.createElement(m.Button,{onClick:function(){return B.globals.app.views.main.router.navigate("/form/"+a)},style:{display:"inline-block"},fill:!0},"Create"))),l))}}]),t}(c.a.Component),se={Tree:oe,Field:null},le="if (!active_id) return false;\nvar context = window.models.env.context;\nvar True = true;\nvar False = false;\nvar None = null;\nreturn ";var ce={};function ue(e){var t=window.models.env.context.active_model;e.f7route&&e.f7route.url?window.models.env.context.active_url=e.f7route.url:window.models.env.context.active_url="/",window.models.env.context.active_id=null,e.f7route&&e.f7route.params&&e.f7route.params.model&&(t=e.f7route.params.model);this.model=t,this.mode="tree";var n=window.tools.view[t].tree;return window.models.env.context.active_model=t,ce[n+(e.title?"-"+e.title:"")]||(ce[n+(e.title?"-"+e.title:"")]=function(e,t,n){return e=(new DOMParser).parseFromString(e,"text/xml").children[0],console.log(e),n&&e.setAttribute("title",n),function e(n,a){var i=[],r=!0,o=!1,s=void 0;try{for(var l,u=function(){var n=l.value,a=se[n.tagName[0].toUpperCase()+n.tagName.toLowerCase().slice(1)]||se[n.tagName]||n.tagName,r={model:t,view_model:t},o=!0,s=!1,u=void 0;try{for(var d,p=n.attributes[Symbol.iterator]();!(o=(d=p.next()).done);o=!0){var m=d.value;r[m.name]=m.value}}catch(b){s=!0,u=b}finally{try{o||null==p.return||p.return()}finally{if(s)throw u}}for(var v=0,f=["invisible","required","readonly"];v<f.length;v++){var h=f[v];if(B.hasKey(r,h)){if(B.hasValue(["true","True"],r[h])&&(r[h]=!0),B.hasValue(["false","False"],r[h])&&(r[h]=!1),r[h].constructor===Boolean)continue;B.hasValue(r[h]," == ")&&(r[h]=r[h].replace("==","===")),B.hasValue(r[h]," != ")&&(r[h]=r[h].replace("!=","!==")),(B.hasValue(r[h]," === ")||B.hasValue(r[h]," !== "))&&(r[h]=new(Function.prototype.bind.apply(Function,[null,"active_id",le+r[h]])))}}r.domain&&(r.domain=new(Function.prototype.bind.apply(Function,[null,"active_id",le+"["+r.domain+"]"]))),r.isTreeView=!0;var w=e(n.children,r)||[function(){return n.innerHTML}];i.push(function(){return c.a.createElement(a,r,w.map(function(e){return e()}))})},d=n[Symbol.iterator]();!(r=(l=d.next()).done);r=!0)u()}catch(p){o=!0,s=p}finally{try{r||null==d.return||d.return()}finally{if(o)throw s}}return i.length?i:null}([e])[0]}(n,t,e.title)),ce[n+(e.title?"-"+e.title:"")]()}var de=function(e){function t(){var e,n;Object(v.a)(this,t);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(n=Object(h.a)(this,(e=Object(w.a)(t)).call.apply(e,[this].concat(i)))).render=ue,n}return Object(b.a)(t,e),Object(f.a)(t,[{key:"componentDidMount",value:function(){var e=this.model,t=this.mode;window.tools.view[e].custom_init&&window.tools.view[e].custom_init[e+"."+t]&&window.tools.view[e].custom_init[e+"."+t].bind(this)(this.props)}}]),t}(c.a.Component),pe=function(e){function t(e){var n;Object(v.a)(this,t),n=Object(h.a)(this,Object(w.a)(t).call(this,e));var a=window.models;return a.env.context.editing=!!e.isCustomView,n.state=a.env.context,n.state.edit_function=n.edit.bind(Object(R.a)(Object(R.a)(n))),n}return Object(b.a)(t,e),Object(f.a)(t,[{key:"componentDidMount",value:function(){var e=Object(o.a)(r.a.mark(function e(t){var n,a;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=window.models.env.context.active_model,(a=window.models).env.context.active_lines={},a.env.context.active_task=[],this,a.env.context.active_ids&&!(a.env.context.active_ids.length<1)&&a.env.context.active_ids[0]){e.next=11;break}return a.env.context.active_id=a.env[n].browse(),e.next=9,window.models.env.context.active_id._wait_promise();case 9:return a.env.context.editing=!0,e.abrupt("return",this.setState(a.env.context));case 11:return e.next=13,a.env[n].browse(a.env.context.active_ids);case 13:return a.env.context.active_id=e.sent,e.abrupt("return",a.env.context.refresh());case 15:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"edit",value:function(){var e=Object(o.a)(r.a.mark(function e(){var t,n,a,i,o,l,c,u,d,p,m,v,f,h,w,b,g,x,y,_;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B.wait_exist(function(){return!B.globals.onchange_running});case 2:if(t=window.models,n=t.env.context.active_id._name,a=!!this.props.offline&&JSON.parse(this.props.offline),this.state.editing){e.next=10;break}return t.env.context.editing=!0,e.next=9,this.setState(Object(s.a)({},t.env.context,{offline:a}));case 9:return e.abrupt("return",e.sent);case 10:return i=t.env.context.active_id.id?"write":"create",e.prev=11,e.next=14,t.env.context.active_id[i]({},!a);case 14:e.next=47;break;case 16:if(e.prev=16,e.t0=e.catch(11),!e.t0||e.t0.constructor!==window.tools.exceptions.RequiredError){e.next=46;break}for(e.t0.field_map={},o=!0,l=!1,c=void 0,e.prev=23,u=e.t0.fields[Symbol.iterator]();!(o=(d=u.next()).done);o=!0)p=d.value,e.t0.field_map[p]=!0;e.next=31;break;case 27:e.prev=27,e.t1=e.catch(23),l=!0,c=e.t1;case 31:e.prev=31,e.prev=32,o||null==u.return||u.return();case 34:if(e.prev=34,!l){e.next=37;break}throw c;case 37:return e.finish(34);case 38:return e.finish(31);case 39:return t.env.context.active_error=e.t0,e.next=42,this.setState({active_id:t.env.context.active_id});case 42:return B.globals.app.toast.create({text:"Some fields are required",closeButton:!1,closeTimeout:2e3,position:"center"}).open(),e.abrupt("return");case 46:throw e.t0;case 47:m=!0,v=!1,f=void 0,e.prev=50,h=t.env.context.active_task[Symbol.iterator]();case 52:if(m=(w=h.next()).done){e.next=61;break}if(b=w.value,!(g=b())||g.constructor!==Promise){e.next=58;break}return e.next=58,g;case 58:m=!0,e.next=52;break;case 61:e.next=67;break;case 63:e.prev=63,e.t2=e.catch(50),v=!0,f=e.t2;case 67:e.prev=67,e.prev=68,m||null==h.return||h.return();case 70:if(e.prev=70,!v){e.next=73;break}throw f;case 73:return e.finish(70);case 74:return e.finish(67);case 75:if(t.env.context.active_task=[],"create"!==i){e.next=94;break}B.globals.app.views.main.router.navigate(window.location.hash.replace("#!","")+"?id="+t.env.context.active_id.id,{reloadCurrent:!0}),x=[],e.t3=r.a.keys(t.env.context.active_lines);case 80:if((e.t4=e.t3()).done){e.next=92;break}y=e.t4.value,e.t5=r.a.keys(t.env.context.active_lines[y]);case 83:if((e.t6=e.t5()).done){e.next=90;break}if("many2many_"!==(_=e.t6.value).slice(0,10)){e.next=87;break}return e.abrupt("continue",83);case 87:x.push(t.env.context.active_lines[y][_].write(Object(A.a)({},_,t.env.context.active_id.id))),e.next=83;break;case 90:e.next=80;break;case 92:return e.next=94,Promise.all(x);case 94:return this.props.isCustomView||(t.env.context.editing=!1),a&&(t.env.context.unsaved=Object(s.a)({},t.env.context.unsaved,Object(A.a)({},n,Object(s.a)({},t.env.context.unsaved&&t.env.context.unsaved[n],Object(A.a)({},t.env.context.active_id.id,t.env.context.active_id.id))))),e.next=98,B.update_session({unsaved:t.env.context.unsaved});case 98:return e.next=100,this.setState(Object(s.a)({},t.env.context,{offline:a}));case 100:case"end":return e.stop()}},e,this,[[11,16],[23,27,31,39],[32,,34,38],[50,63,67,75],[68,,70,74]])}));return function(){return e.apply(this,arguments)}}()},{key:"upload",value:function(){var e=Object(o.a)(r.a.mark(function e(){var t,n,a,i;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B.wait_exist(function(){return!B.globals.onchange_running});case 2:return t=window.models,n=t.env.context.active_id._name,e.next=6,t.env[n].browse(t.env.context.active_id.id);case 6:if(!((a=e.sent).length<1)){e.next=17;break}return i=a,e.next=11,a.create();case 11:return a=e.sent,e.next=14,i.unlink(!1);case 14:t.env.context.active_id=a,e.next=21;break;case 17:return e.next=19,t.env.context.active_id.write();case 19:a=e.sent,t.env.context.active_id=a;case 21:return t.env.context.unsaved&&t.env.context.unsaved[n]&&t.env.context.unsaved[n][a.id]&&delete t.env.context.unsaved[n][a.id],e.next=24,B.update_session({unsaved:t.env.context.unsaved});case 24:return e.next=26,this.setState(Object(s.a)({},t.env.context,{offline:!1}));case 26:return e.abrupt("return",e.sent);case 27:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(e){var t=window.models.env.context.active_model;console.log(this.state);var n={width:"auto",float:"left","margin-right":"10px"},a={};return this.state.offline||(a.display="none"),e.isCustomView?c.a.createElement(U,{title:window.tools.view[t].string},e.children):c.a.createElement(U,{title:window.tools.view[t].string},c.a.createElement("div",{className:"card",style:{margin:0,boxShadow:"none"}},c.a.createElement("div",{className:"card-header"},c.a.createElement("div",{className:"data-table-title"},window.tools.view[t].string,c.a.createElement("span",{style:{color:"#666666"}}," / "+(this.state.active_id&&this.state.active_id.id?this.state.active_id.name:"New")),c.a.createElement("div",null,c.a.createElement(m.Button,{onClick:this.edit.bind(this),style:n,fill:!0},this.state.editing?"Save":"Edit"),c.a.createElement(m.Button,{onClick:function(){return B.globals.app.views.main.router.back()},style:Object(s.a)({},n,this.state.editing?{}:{display:"none"})},"Cancel"),c.a.createElement(m.Button,{onClick:this.upload.bind(this),style:Object(s.a)({},n,a),fill:!0},"Upload")))),e.children))}}]),t}(c.a.Component),me=function(e){return c.a.createElement("div",{style:Object(s.a)({margin:0,backgroundColor:"#8F8F8F",minHeight:"56px"},(e.invisible instanceof Function?e.invisible(window.models.env.context.active_id):e.invisible)?{display:"none"}:{})},e.children)};function ve(){return(ve=Object(o.a)(r.a.mark(function e(t){return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B.wait_exist(function(){return!B.globals.onchange_running});case 2:if(!t.name){e.next=19;break}if(e.prev=3,!window.models.env.context.editing){e.next=7;break}return e.next=7,window.models.env.context.edit_function();case 7:if(window.models.env.context.active_error){e.next=12;break}return e.next=10,window.models.env.context.active_id[t.name]();case 10:return e.next=12,window.models.env.context.refresh();case 12:e.next=19;break;case 14:return e.prev=14,e.t0=e.catch(3),e.next=18,window.models.env.context.refresh();case 18:throw e.t0;case 19:case"end":return e.stop()}},e,null,[[3,14]])}))).apply(this,arguments)}var fe=function(e){function t(e){var n;return Object(v.a)(this,t),(n=Object(h.a)(this,Object(w.a)(t).call(this,e))).state=window.models.env.context,n}return Object(b.a)(t,e),Object(f.a)(t,[{key:"render",value:function(e){var t=this;return c.a.createElement(m.Button,{fill:!0,onClick:function(){return function(e){return ve.apply(this,arguments)}.bind(t)(e)},style:{display:(e.invisible instanceof Function?e.invisible(window.models.env.context.active_id):e.invisible)?"none":"block",float:"left",width:"auto",margin:"10px"}},e.string)}}]),t}(c.a.Component),he=function(e){function t(){return Object(v.a)(this,t),Object(h.a)(this,Object(w.a)(t).apply(this,arguments))}return Object(b.a)(t,e),Object(f.a)(t,[{key:"render",value:function(e){return c.a.createElement("div",{className:"card rapyd-card-sheet",style:{minHeight:"250px",marginTop:"20px"}},c.a.createElement("div",{className:"card-content form-sheet",style:{display:"flex","flex-wrap":"wrap"}},e.children))}}]),t}(c.a.Component),we=function(e){function t(e){var n;return Object(v.a)(this,t),(n=Object(h.a)(this,Object(w.a)(t).call(this,e))).state.previousTitle=!1,n}return Object(b.a)(t,e),Object(f.a)(t,[{key:"componentDidMount",value:function(){var e=Object(o.a)(r.a.mark(function e(){var t,n,a,i,o=this;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B.wait_exist(function(){return o.refs.group});case 2:return e.next=4,B.wait(0);case 4:if(this.props.title){e.next=16;break}t=0,n=0,a=[this.refs.group.previousElementSibling,this.refs.group.nextElementSibling];case 7:if(!(n<a.length)){e.next=16;break}if(!((i=a[n])&&(t?i.offsetLeft>0:0===i.offsetLeft)&&i.querySelector("div.component-group-title"))){e.next=12;break}return this.setState({previousTitle:!0}),e.abrupt("break",16);case 12:t+=1;case 13:n++,e.next=7;break;case 16:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"componentWillUnmount",value:function(){this.interval&&clearInterval(this.interval)}},{key:"render",value:function(e){return e.width&&"%"===e.width.slice(-1)&&parseInt(e.width.slice(0,-1))>97&&(e.width="97%"),c.a.createElement("div",{ref:"group",className:"component-group",style:Object(s.a)({float:"left",width:e.width||"46.5%",padding:"10px",marginTop:"20px",height:"auto"},(e.invisible instanceof Function?e.invisible(window.models.env.context.active_id):e.invisible)?{position:"absolute",left:"-9999px",top:"-9999px"}:{})},(e.title||this.state.previousTitle)&&c.a.createElement(m.BlockTitle,{className:"component-group-title",style:Object(s.a)({fontSize:"25px",lineHeight:"unset"},this.state.previousTitle?{height:"37px"}:{})},e.title||""),e.children)}}]),t}(c.a.Component),be=function(e){function t(){return Object(v.a)(this,t),Object(h.a)(this,Object(w.a)(t).apply(this,arguments))}return Object(b.a)(t,e),Object(f.a)(t,[{key:"render",value:function(e){return c.a.createElement("div",{className:"card",style:Object(s.a)({margin:0,boxShadow:"none",padding:"20px",minHeight:"30%",marginTop:"30px"},(e.invisible instanceof Function?e.invisible(window.models.env.context.active_id):e.invisible)?{display:"none"}:{})},c.a.createElement("div",{className:"card-header"},e.children))}}]),t}(c.a.Component);window.rapydComponents=Object(s.a)({},window.rapydComponents,{Form:pe,Header:me,Button:fe,Sheet:he,Group:we,Field:Z,Tree:oe,Footer:be});var ge="if (!active_id) return false;\nvar context = window.models.env.context;\nvar True = true;\nvar False = false;\nvar None = null;\nreturn ";var xe={},ye=function(e){function t(){return Object(v.a)(this,t),Object(h.a)(this,Object(w.a)(t).apply(this,arguments))}return Object(b.a)(t,e),Object(f.a)(t,[{key:"componentDidUpdate",value:function(){if(this.afterMount)delete this.afterMount;else{var e=this.model,t=this.mode;window.tools.view[e].custom_init&&window.tools.view[e].custom_init[e+"."+t]&&window.tools.view[e].custom_init[e+"."+t].bind(this)(this.props)}}},{key:"componentDidMount",value:function(){var e=this;this.componentDidUpdate(),this.afterMount=!0,B.wait(1e3).then(function(){return e.afterMount=!1})}},{key:"render",value:function(e){var t=this;this.refresh=function(){return t.setState({})}.bind(this),window.models.env.context.refresh=this.refresh;var n=window.models.env.context.active_model;e.f7route&&e.f7route.url?window.models.env.context.active_url=e.f7route.url:window.models.env.context.active_url="/",e.f7route&&e.f7route.params&&e.f7route.params.model&&(n=e.f7route.params.model);this.model=n,this.mode="form";var a=e.f7route.query.id,i=window.tools.view[n].form;return window.models.env.context.active_model=n,a?window.models.env.context.active_ids=[a]:delete window.models.env.context.active_ids,xe[i]||(xe[i]=function(e,t){var n=Object(s.a)({},window.rapydComponents,{Form:pe,Header:me,Button:fe,Sheet:he,Group:we,Field:Z,Tree:oe,Footer:be});return function e(a,i){var r=[],o=!0,s=!1,l=void 0;try{for(var u,d=function(){var a=u.value,o=B.hasValue(a.tagName,"-")?n[a.tagName.split("-").map(function(e){return e[0].toUpperCase()+e.slice(1).toLowerCase()}).join("")]:n[a.tagName[0].toUpperCase()+a.tagName.toLowerCase().slice(1)]||n[a.tagName]||a.tagName,s={model:t},l=!0,d=!1,p=void 0;try{for(var m,v=a.attributes[Symbol.iterator]();!(l=(m=v.next()).done);l=!0){var f=m.value;s[f.name]=f.value}}catch(y){d=!0,p=y}finally{try{l||null==v.return||v.return()}finally{if(d)throw p}}for(var h=0,w=["invisible","required","readonly","create","choose"];h<w.length;h++){var b=w[h];if(B.hasKey(s,b)){if(B.hasValue(["true","True"],s[b])&&(s[b]=!0),B.hasValue(["false","False"],s[b])&&(s[b]=!1),s[b].constructor===Boolean)continue;B.hasValue(s[b]," == ")&&(s[b]=s[b].replace("==","===")),B.hasValue(s[b]," != ")&&(s[b]=s[b].replace("!=","!==")),(B.hasValue(s[b]," === ")||B.hasValue(s[b]," !== "))&&(s[b]=new(Function.prototype.bind.apply(Function,[null,"active_id","parent",ge+s[b]])))}}if(s.domain&&(s.domain=new(Function.prototype.bind.apply(Function,[null,"active_id","parent",ge+"["+s.domain+"]"]))),o===oe){var g=window.models.env[t]._fields[i.name];s.view_model=t,s.field_name=i.name,s.model=g.relation,s.field="one2many"===g.type?g.inverse:i.name,"one2many"!==g.type&&(s.parent_model=t,s.tree_arch=a.outerHTML),i.invisible&&(s.invisible=i.invisible),i.domain&&(s.domain=i.domain)}var x=e(a.children,s)||[function(){return a.innerHTML}];r.push(function(){return c.a.createElement(o,s,x.map(function(e){return e()}))})},p=a[Symbol.iterator]();!(o=(u=p.next()).done);o=!0)d()}catch(m){s=!0,l=m}finally{try{o||null==p.return||p.return()}finally{if(s)throw l}}return r.length?r:null}([e=(new DOMParser).parseFromString(e,"text/xml").children[0]])[0]}(i,n)),xe[i]()}}]),t}(c.a.Component);window.rapydComponents=Object(s.a)({},window.rapydComponents,{TreePage:de,Form:pe,Header:me,Button:fe,Sheet:he,Group:we,Field:Z,Tree:oe,Footer:be});var _e="if (!active_id) return false;\nvar context = window.models.env.context;\nvar True = true;\nvar False = false;\nvar None = null;\nreturn ";var ke={},Oe=function(e){function t(){return Object(v.a)(this,t),Object(h.a)(this,Object(w.a)(t).apply(this,arguments))}return Object(b.a)(t,e),Object(f.a)(t,[{key:"componentDidUpdate",value:function(){if(this.afterMount)delete this.afterMount;else{var e=this.model,t=this.mode;window.tools.view[e].custom_init&&window.tools.view[e].custom_init[e+"."+t]&&window.tools.view[e].custom_init[e+"."+t].bind(this)(this.props)}}},{key:"componentDidMount",value:function(){var e=this;this.componentDidUpdate(),this.afterMount=!0,B.wait(1e3).then(function(){return e.afterMount=!1})}},{key:"render",value:function(e){var t=this;this.refresh=function(){return t.setState({})}.bind(this),window.models.env.context.refresh=this.refresh;var n=window.models.env.context.active_model,a=window.models.env.context.active_mode;if(e.f7route&&e.f7route.url?window.models.env.context.active_url=e.f7route.url:window.models.env.context.active_url="/",e.f7route&&e.f7route.params&&e.f7route.params.view_id){var i=e.f7route.params.view_id.split(".");n=i.slice(0,-1).join("."),a=i[i.length-1]}this.model=n,this.mode=a;var r=window.tools.view[n][a];window.tools.view[n].contexts[a]&&Object.assign(window.models.env.context,window.tools.view[n].contexts[a]),window.models.env.context.active_model=n;var o=e.f7route&&e.f7route.query.id;return o?window.models.env.context.active_ids=[o]:delete window.models.env.context.active_ids,ke[r]||(ke[r]=function(e,t){var n=Object(s.a)({},window.rapydComponents,{TreePage:de,Form:pe,Header:me,Button:fe,Sheet:he,Group:we,Field:Z,Tree:oe,Footer:be});return function e(a,i){var r=[],o=!0,s=!1,l=void 0;try{for(var u,d=function(){var a=u.value,o=B.hasValue(a.tagName,"-")?n[a.tagName.split("-").map(function(e){return e[0].toUpperCase()+e.slice(1).toLowerCase()}).join("")]:n[a.tagName[0].toUpperCase()+a.tagName.toLowerCase().slice(1)]||n[a.tagName]||a.tagName,s={model:t},l=!0,d=!1,p=void 0;try{for(var m,v=a.attributes[Symbol.iterator]();!(l=(m=v.next()).done);l=!0){var f=m.value;s[f.name]=f.value}}catch(y){d=!0,p=y}finally{try{l||null==v.return||v.return()}finally{if(d)throw p}}for(var h=0,w=["invisible","required","readonly"];h<w.length;h++){var b=w[h];if(B.hasKey(s,b)){if(B.hasValue(["true","True"],s[b])&&(s[b]=!0),B.hasValue(["false","False"],s[b])&&(s[b]=!1),s[b].constructor===Boolean)continue;B.hasValue(s[b]," == ")&&(s[b]=s[b].replace("==","===")),B.hasValue(s[b]," != ")&&(s[b]=s[b].replace("!=","!==")),(B.hasValue(s[b]," === ")||B.hasValue(s[b]," !== "))&&(s[b]=new(Function.prototype.bind.apply(Function,[null,"active_id",_e+s[b]])))}}if(s.domain&&(s.domain=new(Function.prototype.bind.apply(Function,[null,"active_id",_e+"["+s.domain+"]"]))),o===oe){var g=window.models.env[t]._fields[i.name];s.view_model=t,s.field_name=i.name,s.model=g.relation,s.field="one2many"===g.type?g.inverse:i.name,"one2many"!==g.type&&(s.parent_model=t,s.tree_arch=a.outerHTML),i.invisible&&(s.invisible=i.invisible),i.domain&&(s.domain=i.domain)}s.isCustomView=!0;var x=e(a.children,s)||[function(){return a.innerHTML}];r.push(function(){return c.a.createElement(o,s,x.map(function(e){return e()}))})},p=a[Symbol.iterator]();!(o=(u=p.next()).done);o=!0)d()}catch(m){s=!0,l=m}finally{try{o||null==p.return||p.return()}finally{if(s)throw l}}return r.length?r:null}([e=(new DOMParser).parseFromString(e,"text/xml").children[0]])[0]}(r,n)),ke[r]()}}]),t}(c.a.Component),Ee=function(e){if(void 0===window.models)return c.a.createElement(M,null);if(window.tools.configuration.home_view){var t=window.tools.configuration.home_view.split(".").slice(-1)[0],n=window.tools.configuration.home_view.split(".").slice(0,-1).join(".");if(window.models.env.context.active_mode=t,window.models.env.context.active_model=n,"tree"===t)return c.a.createElement(de,null);if("form"===t)return c.a.createElement(ye,null);if("chat"!==t)return c.a.createElement(Oe,null)}return c.a.createElement(m.Page,null,c.a.createElement(m.Navbar,null,c.a.createElement(m.NavLeft,null,c.a.createElement(m.Link,{iconMd:"material:menu",panelOpen:"left"})),c.a.createElement(m.NavTitle,null,"Home"),c.a.createElement(m.NavRight,null,c.a.createElement(m.Link,{iconMd:"material:person",panelOpen:"right"}))),c.a.createElement(m.Toolbar,null,c.a.createElement(m.Link,null,"Left Link"),c.a.createElement(m.Link,null,"Right Link")),c.a.createElement(m.Block,{strong:!0},c.a.createElement("p",null,"Here is your blank Framework7 app. Let's see what we have here.")),c.a.createElement(m.BlockTitle,null,"Navigation"),c.a.createElement(m.List,null,c.a.createElement(m.ListItem,{link:"/about/",title:"About"}),c.a.createElement(m.ListItem,{link:"/form/",title:"Form"})),c.a.createElement(m.BlockTitle,null,"Modals"),c.a.createElement(m.Block,{strong:!0},c.a.createElement(m.Row,null,c.a.createElement(m.Col,{width:"50"},c.a.createElement(m.Button,{fill:!0,raised:!0,popupOpen:"#popup"},"Popup")),c.a.createElement(m.Col,{width:"50"},c.a.createElement(m.Button,{fill:!0,raised:!0,loginScreenOpen:"#login-screen"},"Login Screen")))),c.a.createElement(m.BlockTitle,null,"Panels"),c.a.createElement(m.Block,{strong:!0},c.a.createElement(m.Row,null,c.a.createElement(m.Col,{width:"50"},c.a.createElement(m.Button,{fill:!0,raised:!0,panelOpen:"left"},"Left Panel")),c.a.createElement(m.Col,{width:"50"},c.a.createElement(m.Button,{fill:!0,raised:!0,panelOpen:"right"},"Right Panel")))),c.a.createElement(m.List,null,c.a.createElement(m.ListItem,{link:"/dynamic-route/blog/45/post/125/?foo=bar#about",title:"Dynamic Route"}),c.a.createElement(m.ListItem,{link:"/load-something-that-doesnt-exist/",title:"Default Route (404)"})))},je=function(){return c.a.createElement(m.Page,null,c.a.createElement(m.Navbar,{title:"About",backLink:"Back"}),c.a.createElement(m.BlockTitle,null,"About My App"),c.a.createElement(m.Block,{strong:!0},c.a.createElement("p",null,"Here is About page!"),c.a.createElement("p",null,"You can go ",c.a.createElement(m.Link,{back:!0},"back"),"."),c.a.createElement("p",null,"Mauris posuere sit amet metus id venenatis. Ut ante dolor, tempor nec commodo rutrum, varius at sem. Nullam ac nisi non neque ornare pretium. Nulla mauris mauris, consequat et elementum sit amet, egestas sed orci. In hac habitasse platea dictumst."),c.a.createElement("p",null,"Fusce eros lectus, accumsan eget mi vel, iaculis tincidunt felis. Nulla tincidunt pharetra sagittis. Fusce in felis eros. Nulla sit amet aliquam lorem, et gravida ipsum. Mauris consectetur nisl non sollicitudin tristique. Praesent vitae metus ac quam rhoncus mattis vel et nisi. Aenean aliquet, felis quis dignissim iaculis, lectus quam tincidunt ligula, et venenatis turpis risus sed lorem. Morbi eu metus elit. Ut vel diam dolor.")))},Se=function(){return c.a.createElement(m.Page,null,c.a.createElement(m.Navbar,{title:"Not found",backLink:"Back"}),c.a.createElement(m.Block,{strong:!0},c.a.createElement("p",null,"Sorry"),c.a.createElement("p",null,"Requested content not found.")))},Ce=!1;function Te(){B.globals.app.params.panel.leftBreakpoint=Ce?768:1e6,B.globals.app.panel.left.initBreakpoints(),Ce=!Ce}var Ne=function(){return c.a.createElement(m.Page,null,c.a.createElement(m.Navbar,{title:"Menu"}),c.a.createElement("div",{id:"menu",className:"list list-block media-list chevron-center inset",style:{fontWeight:500},panelClose:!0},window.tools.keys(window.tools.menu,"sequence").as_array().map(function(e,t){return c.a.createElement("ul",null,c.a.createElement("li",{className:"accordion-item"},c.a.createElement("a",{className:"item-link item-content"+(window.tools.menu[e].childs.length<1?" panel-close external":""),onClick:window.tools.menu[e].childs.length<1&&function(t){return t.preventDefault()||B.globals.app.panel.left.close()==={}||Object.assign(window.models.env.context,window.tools.menu[e].context)==={}||B.globals.app.views.main.router.navigate(t.currentTarget.href.split("#!")[1])},href:window.tools.menu[e].childs.length<1&&"#!/"+(window.tools.menu[e].view_id?"view":"tree")+"/"+(window.tools.menu[e].view_id||window.tools.menu[e].model),"data-view":"#main-view"},c.a.createElement("div",{className:"item-inner"},c.a.createElement("div",{className:"item-title"},window.tools.menu[e].string))),window.tools.menu[e].childs.as_array().map(function(e,t){return c.a.createElement("div",{className:"accordion-item-content"},c.a.createElement("a",{className:"item-content panel-close external",onClick:function(t){return t.preventDefault()||B.globals.app.panel.left.close()==={}||Object.assign(window.models.env.context,e.context)==={}||B.globals.app.views.main.router.navigate(t.currentTarget.href.split("#!")[1])},href:"#!/"+(e.view_id?"view":"tree")+"/"+(e.view_id||e.model),"data-view":"#main-view"},c.a.createElement("div",{className:"item-inner"},c.a.createElement("div",{className:"item-title"},e.string))))})))})),c.a.createElement(m.Button,{fill:!0,id:"pwa_install_button",onClick:Object(o.a)(r.a.mark(function e(){return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=B.globals.InstallPromp.prompt(),e.t0){e.next=9;break}return e.next=4,B.globals.InstallPromp.userChoice;case 4:if(e.t2=e.sent,e.t1="accepted"===e.t2,!e.t1){e.next=8;break}e.t1=document.getElementById("pwa_install_button").style.display="none";case 8:e.t0=e.t1;case 9:return e.abrupt("return",e.t0);case 10:case"end":return e.stop()}},e)})),style:{display:B.globals.InstallPrompt?"inline-block":"none",margin:"10px"}},"Install"),c.a.createElement(m.Link,{iconMd:"material:more_horiz",iconSize:"30",onClick:Te,style:{display:"inline-block",margin:"10px"}}))},Ie=function(e){function t(e){var n;return Object(v.a)(this,t),(n=Object(h.a)(this,Object(w.a)(t).call(this,e))).render=function(e){return c.a.createElement(m.Page,null,c.a.createElement(m.Navbar,null,c.a.createElement(m.NavLeft,{className:"user-link"},c.a.createElement(m.List,null,c.a.createElement(m.ListItem,{link:"#",title:n.state.name},c.a.createElement(m.Icon,{material:"person"}))))),c.a.createElement(m.Toolbar,{tabbar:!0},c.a.createElement(m.Link,{tabLink:"#notification",tabLinkActive:!0},"Notifications")),c.a.createElement(m.Tabs,null,c.a.createElement(m.Tab,{id:"notification",className:"page-content",tabActive:!0,style:{paddingTop:"0px"}},c.a.createElement(m.List,{mediaList:!0,style:{marginTop:"0px"}},c.a.createElement(m.ListItem,{link:"#",title:"Notification Title",after:"17:20",text:"Notification Text"})),c.a.createElement(m.Button,{fill:!0,onClick:B.logout,style:{display:"inline-block",margin:"10px"}},"Logout"))))},n.state={name:""},n}return Object(b.a)(t,e),Object(f.a)(t,[{key:"componentDidMount",value:function(){var e=Object(o.a)(r.a.mark(function e(t){var n,a;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return B.globals.app=this.$f7,B.globals.app.device.ios&&(n=document.querySelector("meta[name=theme-color]").content,(a=document.createElement("style")).innerHTML="#framework7-root {padding-top: 24px !important; background-color: "+n+" !important} .panel {padding-top: 24px !important; background-color: "+n+" !important}",document.querySelector("head").append(a)),window.tools.navigate=B.globals.app.views.main.router.navigate.bind(B.globals.app.views.main.router),window.tools.dialog=B.globals.app.dialog,e.t0=this,e.next=7,window.models.env.user.browse(window.models.env.user.id.toString()).then(function(e){return e.name});case 7:e.t1=e.sent,e.t2={name:e.t1},e.t0.setState.call(e.t0,e.t2);case 10:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),t}(c.a.Component),Le=function(){return window.models?[{path:"/",component:Ee},{path:"/panel-left/",component:Ne},{path:"/panel-right/",component:Ie},{path:"/about/",component:je},{path:"/tree/:model",component:de},{path:"/form/:model",component:ye},{path:"/view/:view_id",component:Oe},{path:"(.*)",component:Se}]:[{path:"(.*)",component:Ee}]},Ve=function(e){var t,n=window.tools,a=n?{short_name:n.configuration.app_name||"App",name:n.configuration.long_name||n.configuration.app_name||"App",description:n.configuration.app_description||"A webclient for Rapydframework based apps",scope:(t=window.location.origin+window.location.pathname,t.substring(0,t.lastIndexOf("/"))+"/"),start_url:function(e){return e.substring(0,e.lastIndexOf("/"))+"/"}(window.location.origin+window.location.pathname)+"/index.html",display:"standalone",background_color:"white",icons:[{src:function(e){return e.substring(0,e.lastIndexOf("/"))+"/"}(window.location.origin+window.location.pathname)+"/"+(n.configuration.icon_big||"icon-512.png"),sizes:"512x512",type:"image/png"},{src:function(e){return e.substring(0,e.lastIndexOf("/"))+"/"}(window.location.origin+window.location.pathname)+"/"+(n.configuration.icon_small||"icon-192.png"),sizes:"192x192",type:"image/png"}]}:null,i=!1;B.globals.registerManifest=Object(o.a)(r.a.mark(function e(){var t,o;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!i&&n&&window.fetch){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,fetch(document.getElementById("rapyd-app-manifest").href).then(function(e){return e.json()});case 5:e.sent.start_url&&(t=!0),e.next=11;break;case 9:e.prev=9,e.t0=e.catch(2);case 11:if(!t){e.next=13;break}return e.abrupt("return");case 13:a.theme_color=document.querySelector("meta[name=theme-color]").content,o=new Blob([JSON.stringify(a)],{type:"application/json"}),document.getElementById("rapyd-app-manifest").setAttribute("href",URL.createObjectURL(o)),i=!0;case 17:case"end":return e.stop()}},e,null,[[2,9]])}));var s={id:"org.rapyd.client",name:"App",theme:"md",routes:Le(),panel:{swipe:"left",leftBreakpoint:960,swipeThreshold:230}};return c.a.createElement(m.App,{params:s,colorTheme:window.tools&&window.tools.configuration.color_theme?window.tools&&window.tools.configuration.color_theme:"gray"},c.a.createElement(m.Statusbar,null),void 0!==window.models&&c.a.createElement(m.Panel,{left:!0,reveal:!0},c.a.createElement(m.View,{url:"/panel-left/"})),void 0!==window.models&&c.a.createElement(m.Panel,{right:!0,cover:!0},c.a.createElement(m.View,{url:"/panel-right/"})),c.a.createElement(m.View,{id:"main-view",url:"/",main:!0,className:"ios-edges",preloadPreviousPage:!1,pushState:!0}))},De=(n(309),n(311),n(313),n(81));De.install({onInstalled:function(){return De.update()},onUpdateReady:function(){return window.tools?B.globals.app.dialog.confirm("Update available, apply it?",function(){return De.applyUpdate(function(){return window.location.reload()})}):De.applyUpdate(function(){return window.location.reload()})}}),p.a.use(m.default),window.React=c.a,window.ReactDOM=d.a,window.rapydComponents=Object(s.a)({},m,window.rapydComponents,{Page:U,Flatpickr:Y}),Object(o.a)(r.a.mark(function e(){var t,n,a,i;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=B.get_session();try{window.addEventListener("beforeinstallprompt",function(){var e=Object(o.a)(r.a.mark(function e(n){return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n.preventDefault(),e.next=3,t;case 3:return B.globals.InstallPromp=n,e.next=6,B.wait_exist(function(){return document.getElementById("pwa_install_button")});case 6:document.getElementById("pwa_install_button").style.display="inline-block";case 7:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}())}catch(s){console.error(s)}return e.next=4,t;case 4:return(n=window.tools)&&(n.configuration.long_name||n.configuration.app_name)&&(document.querySelector("title").innerHTML=n.configuration.long_name||n.configuration.app_name),e.next=8,d.a.render(c.a.createElement(Ve),document.getElementById("app"));case 8:n&&n.configuration.custom_navbar&&((a=document.createElement("style")).innerHTML=".navbar, .toolbar, .statusbar {background-color: "+window.tools.configuration.custom_navbar+"!important}",document.querySelector("head").append(a)),document.querySelector("div.navbar")&&((i=document.createElement("meta")).name="theme-color",i.content="#"+getComputedStyle(document.querySelector(".navbar"),null).backgroundColor.replace("rgb(","").replace(")","").split(", ").map(function(e){return parseInt(e).toString(16)}).map(function(e){return 1===e.length?"0"+e:e}).join(""),document.querySelector("head").appendChild(i),B.globals.registerManifest());case 10:case"end":return e.stop()}},e)}))()},79:function(e,t){if(!window.ReactDOM)throw Error("ReactDOM must be defined on global variable");e.exports=window.ReactDOM}},[[205,2,1]]]);
//# sourceMappingURL=main.90bfceee.chunk.js.map